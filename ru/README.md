# Руководство по настройке узла zkSync Era

Это руководство объясняет шаг за шагом, как настроить узел `zkSync Era` на Ubuntu Linux.

## Системные требования

- ЦП: Рекомендуется относительно современный процессор.
- ОЗУ: 32 ГБ
- Хранилище: 300 ГБ, с приростом состояния около 1 ТБ в месяц.
- Сеть: Подключение 100 Мбит/с (рекомендуется 1 Гбит/с и выше)

### Аренда Сервера

Если вам нужен сервер, вы можете арендовать его у Hetzner. Кроме того, если вы зарегистрируетесь по этой реферальной ссылке, вы получите кредит в размере 20 евро.

[Hetzner](https://hetzner.cloud/?ref=fu2umOyLCWhh)

## Шаг 1: Установка Visual Studio Code (на локальном компьютере)

1. **Скачать и установить Visual Studio Code:**
   [Страница загрузки Visual Studio Code](https://code.visualstudio.com/)

   - После загрузки следуйте мастеру установки для установки Visual Studio Code.

2. **Установить расширение SSH:**
   - Откройте Visual Studio Code.
   - Щелкните на значок `Расширения` на левой боковой панели.
   - Введите `Remote - SSH` в строке поиска и установите расширение, разработанное Microsoft.

## Шаг 2: Подключение к серверу через SSH (с локального компьютера)

1. **Подключение к SSH в Visual Studio Code:**

   - Нажмите `Ctrl+Shift+P` в Visual Studio Code и выберите `Remote-SSH: Connect to Host...`.
   - Введите адрес вашего сервера в формате `ssh root@ip_address`.
   - Введите ваш пароль или SSH-ключ для завершения подключения.

   **Примечание:** Замените `ip_address` на фактический IP-адрес вашего сервера.

2. **Проверка подключения:**

   - Если подключение прошло успешно, имя подключенного сервера появится в нижнем левом углу окна Visual Studio Code.

3. **Открытие терминала:**
   - После подключения к серверу в Visual Studio Code вы можете открыть терминал, нажав `Терминал` > `Новый терминал` в верхнем меню.
   - Либо нажмите `Ctrl+` (клавиша Control и клавиша обратного апострофа, расположенная под клавишей ESC).

## Шаг 3: Установка Docker и Docker Compose (на сервере)

После успешного подключения к серверу выполните следующие команды на сервере.

### Установка Docker

1. **Обновить системные пакеты:**

   ```sh
   sudo apt update
   ```

2. **Установить Docker:**

   ```sh
   sudo apt install docker.io
   ```

3. **Проверить, что служба Docker работает:**

   ```sh
   sudo systemctl status docker
   ```

4. **Проверить установку Docker:**
   ```sh
   docker --version
   ```

### Установка Docker Compose

1. **Скачать Docker Compose:**

   ```sh
   sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
   ```

2. **Предоставить разрешение на выполнение Docker Compose:**

   ```sh
   sudo chmod +x /usr/local/bin/docker-compose
   ```

3. **Проверить установку:**
   ```sh
   docker-compose --version
   ```

## Шаг 4: Запуск узла zkSync Era (на сервере)

1. **Установить Git (если не установлен):**

   ```sh
   sudo apt install git
   ```

2. **Клонировать репозиторий:**

   ```sh
   git clone https://github.com/matter-labs/zksync-era.git
   ```

3. **Перейти в клонированные каталоги:**

   ```sh
   cd zksync-era/docs/guides/external-node
   cd docker-compose-examples
   ```

4. **Запустить узел с помощью Docker Compose:**

   ```sh
   docker-compose -f mainnet-external-node-docker-compose.yml up -d
   ```

5. **Проверить работающие контейнеры:**

   ```sh
   docker ps
   ```

   Эта команда выводит список работающих контейнеров Docker. Вы должны увидеть контейнеры, связанные с узлом `zkSync Era`.

6. **Просмотр и отслеживание последних 100 журналов:**
   ```sh
   docker logs -f --tail 100 docker-compose-examples-external-node-1
   ```
   Нажмите `Ctrl+C`, чтобы выйти из просмотра журнала. Это не остановит ваш узел; он продолжит работать в фоновом режиме.

## Шаг 5: Доступ к панели управления через перенаправление порта (на локальном компьютере)

После запуска Docker вы можете получить доступ к панели управления на порту 3000. Чтобы просмотреть эту панель управления с вашего локального компьютера, вам необходимо настроить перенаправление порта в Visual Studio Code.

1. **Настройка перенаправления порта:**

   - Нажмите `Ctrl+Shift+P`, чтобы открыть палитру команд.
   - Введите `Forward a Port` и выберите этот вариант.
   - Введите `3000` в качестве номера порта и нажмите Enter.

   Либо:

   - Нажмите на раздел `PORTS` в правом нижнем углу Visual Studio Code.
   - Выберите `Forward Port...` в меню.
   - Введите `3000` в качестве номера порта и нажмите Enter.

2. **Доступ к панели управления:**

   - Откройте веб-браузер и перейдите по адресу `http://localhost:3000/d/0/external-node`.
   - Теперь у вас должен быть доступ к панели управления.

Этот шаг позволяет легко просматривать панель управления работающего на вашем удаленном сервере приложения с вашего локального компьютера.

## Дополнительная информация

- **Просмотр журналов контейнеров:**

  ```sh
  docker logs <container_id>
  ```

- **Остановить узел:**
  ```sh
  docker-compose -f mainnet-external-node-docker-compose.yml down
  ```
